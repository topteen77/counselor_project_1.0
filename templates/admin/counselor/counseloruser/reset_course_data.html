{% extends "admin/base_site.html" %}
{% load i18n admin_urls static %}

{% block title %}Reset Course Data{% endblock %}

{% block content %}
<div class="content">
    <h1>Reset Course Data for Selected Users</h1>
    
    <p>You have selected the following users:</p>
    <ul>
        {% for user in users %}
        <li><strong>{{ user.username }}</strong> ({{ user.email }})</li>
        {% endfor %}
    </ul>
    
    <form method="post" action="" id="resetForm">
        {% csrf_token %}
        
        <fieldset class="module aligned">
            <div class="form-row">
                <div>
                    <label><strong>Select Course(s) to Reset:</strong></label>
                    <div style="margin-top: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; max-height: 300px; overflow-y: auto; background-color: #fff;">
                        <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #ddd;">
                            <label style="font-weight: bold; cursor: pointer;">
                                <input type="checkbox" id="selectAllCourses" style="margin-right: 5px; cursor: pointer;">
                                <span style="color: #000; font-weight: bold;">Select All Courses</span>
                            </label>
                        </div>
                        {% for course in courses %}
                        <div style="margin: 5px 0;">
                            <label style="cursor: pointer; display: block; padding: 5px;">
                                <input type="checkbox" name="courses" value="{{ course.id }}" class="course-checkbox" style="margin-right: 8px; cursor: pointer;">
                                <span style="color: #000;">{{ course.title }}</span>
                            </label>
                        </div>
                        {% empty %}
                        <p style="color: #666; font-style: italic;">No courses available.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </fieldset>
        
        <div class="submit-row" style="margin: 20px 0; padding: 15px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px;">
            <div style="color: #856404;">
                <strong style="color: #856404;">⚠️ Warning:</strong> <span style="color: #856404;">This action will permanently delete the following data for the selected users in the chosen course(s):</span>
                <ul style="margin-top: 10px; margin-left: 20px; color: #856404;">
                    <li style="color: #856404;">Quiz Results and Scores</li>
                    <li style="color: #856404;">Course Content Progress</li>
                    <li style="color: #856404;">User Progress Tracking</li>
                    <li style="color: #856404;">Quiz Attempt Tracking</li>
                    <li style="color: #856404;">Certifications</li>
                </ul>
                <p style="margin-top: 10px; margin-bottom: 0; color: #856404;"><strong style="color: #856404;">This action cannot be undone!</strong></p>
            </div>
        </div>
        
        <div class="submit-row">
            <input type="hidden" name="action" value="reset_course_data" />
            {% for user in users %}
            <input type="hidden" name="{{ action_checkbox_name }}" value="{{ user.id }}" />
            {% endfor %}
            
            <input type="submit" name="apply" value="Reset Course Data" class="default" id="submitBtn" style="background-color: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;" />
            <a href="{% url 'admin:counselor_counseloruser_changelist' %}" class="button" style="margin-left: 10px; padding: 10px 20px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 4px; display: inline-block;">Cancel</a>
        </div>
    </form>
</div>

<script>
    // Select All functionality
    document.getElementById('selectAllCourses').addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('.course-checkbox');
        checkboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
    });
    
    // Update Select All checkbox when individual checkboxes change
    document.querySelectorAll('.course-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const allCheckboxes = document.querySelectorAll('.course-checkbox');
            const checkedCount = document.querySelectorAll('.course-checkbox:checked').length;
            document.getElementById('selectAllCourses').checked = checkedCount === allCheckboxes.length && allCheckboxes.length > 0;
        });
    });
    
    // Form validation
    document.getElementById('resetForm').addEventListener('submit', function(e) {
        const selectedCourses = document.querySelectorAll('.course-checkbox:checked');
        if (selectedCourses.length === 0) {
            e.preventDefault();
            alert('Please select at least one course to reset.');
            return false;
        }
    });
</script>
{% endblock %}
